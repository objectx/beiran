# Beiran Daemon tests
# please see to get help: https://github.com/svanoort/pyresttest/blob/master/advanced_guide.md
---
- config:
  - testset: "Beiran"
  - variable_binds:
    - sample_image_name: 'hello-world'

- test:
  - name: "Version from root handler"
  - headers: {accept: 'application/json'}
  - url: "/"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}
     - compare: {jsonpath_mini: "version",   comparator: "eq",     expected: "0.0.1"}

- test:
  - name: "Info endpoint"
  - headers: {accept: 'application/json'}
  - url: "/info"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}
     - compare: {jsonpath_mini: "beiran_version",   comparator: "eq",     expected: "0.0.1"}


- test:
  - name: "Pull Sample Image"
  - headers: {accept: 'application/json'}
  - url: {template: "/image/pull/$sample_image_name"}
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}
     - compare: {jsonpath_mini: "statuses.-1.status",   comparator: "contains",     expected: {template: "Downloaded newer image for $sample_image_name:latest"}}


- test:
  - name: "List Images"
  - headers: {accept: 'application/json'}
  - url: "/images"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}

- test:
  - name: "List Image, Filter SampleImage"
  - headers: {accept: 'application/json'}
  - url: {template: "/images?filter=$sample_image_name"}
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}
     - compare: {jsonpath_mini: "images.0.RepoTags",   comparator: "contains",     expected: {template: "$sample_image_name:latest"}}
