# Beiran Daemon tests
# please see to get help: https://github.com/svanoort/pyresttest/blob/master/advanced_guide.md
---
- config:
  - testset: "Beiran"

- test:
  - name: "Version from root handler"
  - headers: {accept: 'application/json'}
  - url: "/"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}
     - compare: {jsonpath_mini: "version",   comparator: "eq",     expected: "0.0.6"}

- test:
  - name: "Info endpoint"
  - headers: {accept: 'application/json'}
  - url: "/info"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}
     - compare: {jsonpath_mini: "beiran_version",   comparator: "eq",     expected: "0.0.6"}


- test:
  - name: "List Images"
  - headers: {accept: 'application/json'}
  - url: "/images"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}


- test:
  - name: "List All Images"
  - headers: {accept: 'application/json'}
  - url: "/images?all=true"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}


- test:
  - name: "List Layers"
  - headers: {accept: 'application/json'}
  - url: "/layers"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}


- test:
  - name: "List All Layers"
  - headers: {accept: 'application/json'}
  - url: "/layers?all=true"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/json'}

- test:
  - name: "Layer Download"
  - headers: {accept: 'application/json'}
  - url: "/layers/sha256:3d77ce4481b119f00e53bee9b4a443469c42c224db954ddaa2e6b74cd73cd5d0"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/octet-stream'}
     - compare: {header: "Docker-Content-Digest", comparator: contains, expected: 'sha256:3d77ce4481b119f00e53bee9b4a443469c42c224db954ddaa2e6b74cd73cd5d0'}
     - compare: {header: "Etag", comparator: contains, expected: 'sha256:3d77ce4481b119f00e53bee9b4a443469c42c224db954ddaa2e6b74cd73cd5d0'}
     - compare: {header: "Content-Length", comparator: equals, expected: '132700160'}

- test:
  - name: "Layer Download HEAD"
  - headers: {accept: 'application/json'}
  - url: "/layers/sha256:3d77ce4481b119f00e53bee9b4a443469c42c224db954ddaa2e6b74cd73cd5d0"
  - method: "HEAD"
  - expected_status: [200]
  - validators:
     - compare: {header: "content-type", comparator: contains, expected: 'application/octet-stream'}
     - compare: {header: "Docker-Content-Digest", comparator: contains, expected: 'sha256:3d77ce4481b119f00e53bee9b4a443469c42c224db954ddaa2e6b74cd73cd5d0'}
     - compare: {header: "Etag", comparator: contains, expected: 'sha256:3d77ce4481b119f00e53bee9b4a443469c42c224db954ddaa2e6b74cd73cd5d0'}
     - compare: {header: "Content-Length", comparator: equals, expected: '2'}
